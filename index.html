<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vishnu Bajpai – Recruiter Q&A</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#070a0f;
      --card:#0e1622;
      --muted:#a6b3c3;
      --text:#eaf2ff;
      --accent:#86d5ff;
      --ring: rgba(134,213,255,0.45);
      --border: rgba(255,255,255,0.08);
      --chip:#121c2b;
      --chip2:#0f1a29;
      --ok:#23d18b;
    }
    *{box-sizing:border-box}
    body{margin:0;background:
      radial-gradient(1000px 600px at 80% -10%, rgba(134,213,255,0.10), transparent),
      linear-gradient(180deg,#06090d 0%,#0a121c 60%,#070a0f 100%);
      color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    a{color:inherit; text-decoration:none}
    .container{max-width:980px;margin:0 auto;padding:24px}
    .hero{
      display:flex;justify-content:space-between;align-items:center;gap:16px;
      padding:16px 18px;border:1px solid var(--border);border-radius:16px;
      background:linear-gradient(180deg,rgba(255,255,255,0.05),rgba(255,255,255,0.02));
      box-shadow:0 10px 30px rgba(0,0,0,0.35);
      position:sticky; top:12px; backdrop-filter: blur(6px); z-index:5;
    }
    .title{display:flex;flex-direction:column;gap:4px}
    h1{font-size:20px; margin:0}
    .subtitle{font-size:13px;color:var(--muted)}
    .meta{display:flex;gap:10px;flex-wrap:wrap; margin-top:4px}
    .pill{background:var(--chip);border:1px solid var(--border);padding:6px 10px;border-radius:999px;font-size:12px;color:var(--muted)}
    .links{display:flex;flex-direction:column; gap:6px; align-items:flex-end}
    .btn{
      border:1px solid var(--border);background:var(--chip2);color:var(--text);
      padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:600; display:inline-block
    }
    .btn:hover{outline:1px solid var(--ring)}
    .grid{display:grid;grid-template-columns: 1.1fr 0.9fr;gap:16px;margin-top:16px}
    @media (max-width: 900px){ .grid{ grid-template-columns:1fr; } .links{align-items:flex-start} }
    .card{
      border:1px solid var(--border);border-radius:16px;background:var(--card);
      box-shadow:0 8px 22px rgba(0,0,0,0.35); padding:14px;
    }
    .section-title{font-weight:700; font-size:14px; letter-spacing:0.3px; color:#cfe8ff; margin-bottom:8px}
    .faq-group{margin-bottom:10px}
    .group-head{
      display:flex;align-items:center;justify-content:space-between;
      background:linear-gradient(180deg,#0b1320,#0c1524);
      border:1px solid var(--border);border-radius:12px;padding:10px 12px;cursor:pointer;
    }
    .group-head:hover{border-color:var(--ring)}
    .group-title{font-size:13px;color:#d5e9ff;font-weight:700}
    .group-body{padding:10px 4px 2px 4px; display:none}
    .faq-grid{display:grid;grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width: 700px){ .faq-grid{grid-template-columns:1fr} }
    .faq-card{
      border:1px solid var(--border); border-radius:12px; background:linear-gradient(180deg,#0b1320,#0c1524);
      padding:12px; cursor:pointer; transition: transform .08s ease-out, border-color .12s;
    }
    .faq-card:hover{ transform: translateY(-1px); border-color: var(--ring); }
    .faq-q{font-size:13px; color:#d5e9ff; margin:0}
    .faq-a{font-size:13px; color:#a9b9cd; margin-top:8px; white-space:pre-wrap}
    .choice{display:flex; gap:8px; margin-top:8px}
    .chip-btn{background:transparent; border:1px solid var(--ring); color:var(--accent); padding:6px 10px; border-radius:999px; cursor:pointer; font-weight:600}
    .chip-btn:hover{background:rgba(134,213,255,0.06)}
    .divider{height:1px;background:var(--border);margin:10px 0}
    .mini{font-size:12px; color:var(--muted)}
    .muted{color:var(--muted)}
    .list{display:grid; gap:6px; font-size:13px; color:var(--muted)}
    .ok{color:var(--ok)}
    .contact-lines{font-size:12px; color:var(--muted); text-align:right}
    .stacked{display:grid; gap:6px}
    .box{border:1px solid var(--border); background:#0b1320; border-radius:10px; padding:10px}
    .box h4{margin:0 0 6px 0; font-size:12px; color:#cfe8ff}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:12px}
    .ask{display:flex; gap:8px; margin-bottom:10px}
    input[type="text"]{flex:1; padding:12px 12px; border-radius:12px; border:1px solid var(--border); background:#0b1220; color:var(--text)}
    .bubble{background:#0c1420;border:1px solid var(--border); padding:10px 12px;border-radius:12px; line-height:1.5; white-space:pre-wrap; margin-top:8px}
    .msg-who{font-size:12px; color:#a6b3c3; margin-top:10px}
    .sugg{display:flex; flex-wrap:wrap; gap:8px; margin-top:6px}
  </style>
</head>
<body>
  <div class="container">
    <div class="hero">
      <div class="title">
        <h1 id="name">Vishnu Bajpai</h1>
        <div class="subtitle" id="headline">MarTech Project Manager | CRM | Growth Strategy | Data-Driven Execution</div>
        <div class="meta" id="quick-meta"></div>
      </div>
      <div class="links">
        <div class="contact-lines">
          <div id="emailLine">email:</div>
          <div id="mobileLine">mobile:</div>
        </div>
        <a id="lnkLinkedin" class="btn" target="_blank" rel="noopener">LinkedIn</a>
      </div>
    </div>

    <div class="grid">
      <!-- Left: Ask + FAQs (grouped) -->
      <div class="card">
        <div class="section-title">Ask or browse FAQs</div>
        <div class="ask">
          <input id="q" type="text" placeholder="Ask in plain language (e.g., business impact, KPIs, platforms, roles)"/>
          <button id="ask" class="btn">Ask</button>
        </div>
        <div id="askAns" class="mini muted">Hint: Try keywords like “impact”, “KPIs”, “platforms”, “roles”.</div>
        <div class="divider"></div>
        <div id="faqGroups"></div>
      </div>

      <!-- Right: Snapshot -->
      <div class="card">
        <div class="section-title">Snapshot</div>
        <div id="snapshot" class="stacked"></div>
      </div>
    </div>
  </div>

<script>
  let RESUME=null;
  let openFAQCard = null;

  async function loadResume(){
    try{
      const r = await fetch('resume.json', {cache:'no-store'});
      RESUME = await r.json();
      hydrateHero();
      renderSnapshot();
      renderFAQGroups();
      wireAsk();
    }catch(e){
      console.error('Failed to load resume.json', e);
      document.getElementById('snapshot').innerHTML = '<div class="muted">Error loading data. Please ensure resume.json is hosted next to index.html or use a local server.</div>';
    }
  }

  function hydrateHero(){
    document.getElementById('headline').textContent = (RESUME.headline || '').replace('Vishnu Bajpai — ','').trim();
    const meta = document.getElementById('quick-meta');
    meta.innerHTML = '';
    if(RESUME['preferred locations']){
      const loc = document.createElement('span'); loc.className='pill'; loc.textContent = 'Preferred location: ' + RESUME['preferred locations'].join(', '); meta.appendChild(loc);
    }
    if(RESUME.availability){
      const av = document.createElement('span'); av.className='pill ok'; av.textContent = 'Availability: ' + RESUME.availability; meta.appendChild(av);
    }
    const email = RESUME.contact?.email || '';
    const phone = RESUME.contact?.phone || '';
    document.getElementById('emailLine').textContent = 'email: ' + email;
    document.getElementById('mobileLine').textContent = 'mobile: ' + phone;
    const lnkL = document.getElementById('lnkLinkedin');
    lnkL.href = RESUME.contact?.linkedin || '#';
  }

  // Snapshot: use rich text if provided
  function renderSnapshot(){
    const S = document.getElementById('snapshot');
    const rich = RESUME.snapshot?.rich || '';
    if(rich){
      S.innerHTML = '<div class="bubble">'+escapeHtml(rich)+'</div>';
      return;
    }
    const brief = RESUME.snapshot?.headline || RESUME.summary || '';
    const hello = RESUME.snapshot?.hello || "Hi — welcome to the recruiter-focused chatbot. Browse the grouped FAQs or use the Ask box.";
    S.innerHTML = '<div>'+escapeHtml(brief)+'</div><div class="muted">'+escapeHtml(hello)+'</div>';
  }

  // Grouped FAQs
  function renderFAQGroups(){
    const wrap = document.getElementById('faqGroups');
    wrap.innerHTML = '';
    const groups = RESUME.faq_groups || [];
    groups.forEach(g=>{
      const gEl = document.createElement('div');
      gEl.className = 'faq-group';

      const head = document.createElement('div');
      head.className = 'group-head';
      const title = document.createElement('div');
      title.className = 'group-title';
      title.textContent = g.title + ' (' + (g.items?.length||0) + ')';
      const caret = document.createElement('div');
      caret.textContent = '▶';
      head.appendChild(title);
      head.appendChild(caret);

      const body = document.createElement('div');
      body.className = 'group-body';
      const grid = document.createElement('div');
      grid.className = 'faq-grid';
      body.appendChild(grid);

      (g.items||[]).forEach(f=>{
        const card = document.createElement('div');
        card.className='faq-card';
        card.innerHTML = `<p class="faq-q">${f.q}</p>`;
        card.onclick = ()=> toggleFAQ(card, f);
        grid.appendChild(card);
      });

      head.onclick = ()=>{
        const open = body.style.display==='block';
        body.style.display = open ? 'none' : 'block';
        caret.style.transform = open ? '' : 'rotate(90deg)';
      };

      gEl.appendChild(head);
      gEl.appendChild(body);
      wrap.appendChild(gEl);
    });
  }

  function toggleFAQ(card, faq){
    if(openFAQCard === card){
      collapseFAQ(card);
      openFAQCard = null;
      return;
    }
    if(openFAQCard) collapseFAQ(openFAQCard);
    showChoice(card, faq);
    openFAQCard = card;
  }
  function collapseFAQ(card){
    const choice = card.querySelector('.choice');
    const ans = card.querySelector('.faq-a');
    if(choice) choice.remove();
    if(ans) ans.remove();
  }
  function showChoice(parent, faq){
    collapseFAQ(parent);
    const wrap = document.createElement('div');
    wrap.className='choice';
    const s = document.createElement('button'); s.className='chip-btn'; s.textContent='Short';
    const l = document.createElement('button'); l.className='chip-btn'; l.textContent='Long';
    s.onclick = (e)=>{ e.stopPropagation(); showAnswer(parent, faq.a_short || '—'); };
    l.onclick = (e)=>{ e.stopPropagation(); showAnswer(parent, faq.a_long || '—'); };
    parent.appendChild(wrap);
    wrap.appendChild(s); wrap.appendChild(l);
  }
  function showAnswer(parent, text){
    let a = parent.querySelector('.faq-a');
    if(!a){
      a = document.createElement('div');
      a.className='faq-a';
      parent.appendChild(a);
    }
    a.textContent = text;
  }

  // Ask → broader-intent matcher with top-2 fallback
  function wireAsk(){
    const btn = document.getElementById('ask');
    const input = document.getElementById('q');
    const out = document.getElementById('askAns');

    // --- Stopwords
    const STOP = new Set(("a an and are as at be by for from has have i in into is it its of on or that the their there this to was were what when where which who why will with you your about").split(" "));

    // --- Synonyms / expansions to understand user intent better
    const EXPAND = {
      roles:["role","roles","title","titles","position","positions","targeting","openings"],
      experience:["experience","background","years","timeline","worked","industries","domain","sectors"],
      impact:["impact","kpi","kpis","metrics","roi","retention","nps","csat","conversion","revenue","leads","uplift","improvement","outcomes"],
      platforms:["platform","platforms","stack","tools","crm","braze","moengage","clevertap","salesforce","hubspot","marketo","firebase","appsflyer","analytics","tableau","metabase","kibana","ga","google","jira","asana"],
      delivery:["project","projects","delivery","governance","agile","sprint","raic","raci","raid","moscow","dependency","risk","roadmap","velocity","milestone","timeline"],
      leadership:["leadership","lead","mentor","mentoring","manage","management","team","stakeholder","cross-functional","collaboration","behavioral","culture","working","communication"]
    };

    // --- Keywords to boost relevant groups (title → triggers)
    const GROUP_TRIGGERS = {
      "Experience & Impact":[...EXPAND.experience, ...EXPAND.impact],
      "Generic Profile":[...EXPAND.roles, "strengths","join","availability","motivation","future","goal","goals"],
      "CRM & Lifecycle":[...EXPAND.platforms, "lifecycle","journey","segmentation","campaign","message","personalization","send","frequency","suppression","attribution"],
      "Project Management":[...EXPAND.delivery, "planning","go-live","release","qa","risk","dependency"],
      "Behavioral & Ways of Working":[...EXPAND.leadership, "conflict","deadline","pressure","ambiguity","ownership","problem","solve","decision"]
    };

    // --- Tokenize with expansion
    function tok(s){
      const base = (s||'').toLowerCase().replace(/[^\w\s]/g,' ').split(/\s+/).filter(x=>x && !STOP.has(x));
      // expand
      const expanded = new Set(base);
      base.forEach(t=>{
        for(const k in EXPAND){
          if(EXPAND[k].includes(t)) EXPAND[k].forEach(x=>expanded.add(x));
        }
        // light stemming
        if(t.endsWith('s')) expanded.add(t.slice(0,-1));
        if(t.endsWith('ing')) expanded.add(t.slice(0,-3));
      });
      return Array.from(expanded);
    }

    // --- Jaccard + overlap score
    function jaccard(a,b){
      const A=new Set(a), B=new Set(b);
      const inter = [...A].filter(x=>B.has(x)).length;
      const uni = new Set([...A,...B]).size || 1;
      return inter/uni;
    }

    // --- Detect intent groups to boost
    function detectGroups(qTokens){
      const hits = {};
      for(const g in GROUP_TRIGGERS){
        const tset = new Set(GROUP_TRIGGERS[g]);
        const overlap = qTokens.filter(x=>tset.has(x)).length;
        if(overlap>0) hits[g] = overlap; // frequency-based boost
      }
      return hits; // {groupTitle: count}
    }

    function rank(q){
      const qt = tok(q);
      const groupHits = detectGroups(qt); // intended group signals
      const scored = [];
      (RESUME.faq_groups||[]).forEach(g=>{
        (g.items||[]).forEach(f=>{
          const ft = tok(f.q);
          const base = jaccard(qt, ft);
          // small token overlap bonus
          const overlap = new Set(qt.filter(x=>ft.includes(x))).size;
          // group boost if user's intent hits this group's triggers
          const gBoost = groupHits[g.title] ? Math.min(0.25, 0.05 * groupHits[g.title]) : 0;
          // total
          const score = base + (0.02 * overlap) + gBoost;
          scored.push({faq:f, score, group:g.title});
        });
      });
      scored.sort((a,b)=> b.score-a.score);
      return {qt, groupHits, ranked:scored};
    }

    function renderOne(faq){
      const title = `I believe you meant to ask: “${faq.q}”`;
      out.innerHTML = '<div class="msg-who">'+title+'</div>' +
        `<div class="choice" style="margin-top:6px">
          <button class="chip-btn" id="askShort">Short</button>
          <button class="chip-btn" id="askLong">Long</button>
        </div>`;
      document.getElementById('askShort').onclick = ()=>{
        out.innerHTML = '<div class="msg-who">'+title+'</div><div class="bubble">'+escapeHtml(faq.a_short || '—')+'</div>';
      };
      document.getElementById('askLong').onclick = ()=>{
        out.innerHTML = '<div class="msg-who">'+title+'</div><div class="bubble">'+escapeHtml(faq.a_long || '—')+'</div>';
      };
    }

    function renderSuggestions(arr){
      if(!arr.length){
        out.innerHTML = '<div class="msg-who">No close match found.</div>';
        return;
      }
      const top2 = arr.slice(0,2);
      const title = 'I found a couple of close matches — pick one:';
      out.innerHTML = '<div class="msg-who">'+title+'</div><div class="sugg" id="suggBox"></div>';
      const box = document.getElementById('suggBox');
      top2.forEach((r)=>{
        const b = document.createElement('button');
        b.className='chip-btn';
        b.textContent = r.faq.q;
        b.onclick = ()=> renderOne(r.faq);
        box.appendChild(b);
      });
    }

    btn.onclick = ()=>{
      const q = input.value.trim();
      if(!q) return;
      const {qt, groupHits, ranked} = rank(q);
      if(ranked.length===0){
        out.innerHTML = '<div class="msg-who">No match yet. Try rephrasing.</div>';
        return;
      }

      // thresholds
      const best = ranked[0];
      if(best.score >= 0.50){
        renderOne(best.faq);
      }else if(best.score >= 0.25){
        renderSuggestions(ranked);
      }else{
        // if intent detected, bias suggestions to the strongest group even when global score is low
        const groups = Object.keys(groupHits);
        if(groups.length){
          const topGroup = groups.sort((a,b)=> groupHits[b]-groupHits[a])[0];
          const filtered = ranked.filter(r=>r.group===topGroup);
          if(filtered.length){
            renderSuggestions(filtered);
          }else{
            out.innerHTML = '<div class="msg-who">I could not confidently match that. Try keywords like “impact”, “KPIs”, “platforms”, “roles”.</div>';
          }
        }else{
          out.innerHTML = '<div class="msg-who">I could not confidently match that. Try keywords like “impact”, “KPIs”, “platforms”, “roles”.</div>';
        }
      }
      input.value='';
    };
  }

  function escapeHtml(s){ return (s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

  loadResume();
</script>
</body>
</html>
